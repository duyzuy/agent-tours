!function(){"use strict";var e=tinymce.util.Tools.resolve("tinymce.PluginManager");let t=e=>o=>(e=>{var o,u;let m=typeof e;return null===e?"null":"object"===m&&Array.isArray(e)?"array":"object"===m&&((o=String).prototype.isPrototypeOf(e)||(null===(u=e.constructor)||void 0===u?void 0:u.name)===o.name)?"string":m})(o)===e,o=t("string"),u=t("object"),m=t("array"),s=e=>"function"==typeof e,l=()=>!1;var p=tinymce.util.Tools.resolve("tinymce.util.Tools");let c=e=>o=>o.options.get(e),d=c("template_cdate_classes"),h=c("template_mdate_classes"),g=c("template_selected_content_classes"),v=c("template_preview_replace_values"),y=c("template_replace_values"),f=c("templates"),b=c("template_cdate_format"),S=c("template_mdate_format"),x=c("content_style"),C=c("content_css_cors"),E=c("body_class"),_=(e,o)=>{if((e=""+e).length<o)for(let u=0;u<o-e.length;u++)e="0"+e;return e},M=(e,o,u=new Date)=>(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=o.replace("%D","%m/%d/%Y")).replace("%r","%I:%M:%S %p")).replace("%Y",""+u.getFullYear())).replace("%y",""+u.getYear())).replace("%m",_(u.getMonth()+1,2))).replace("%d",_(u.getDate(),2))).replace("%H",""+_(u.getHours(),2))).replace("%M",""+_(u.getMinutes(),2))).replace("%S",""+_(u.getSeconds(),2))).replace("%I",""+((u.getHours()+11)%12+1))).replace("%p",12>u.getHours()?"AM":"PM")).replace("%B",""+e.translate("January February March April May June July August September October November December".split(" ")[u.getMonth()]))).replace("%b",""+e.translate("Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ")[u.getMonth()]))).replace("%A",""+e.translate("Sunday Monday Tuesday Wednesday Thursday Friday Saturday Sunday".split(" ")[u.getDay()]))).replace("%a",""+e.translate("Sun Mon Tue Wed Thu Fri Sat Sun".split(" ")[u.getDay()]))).replace("%%","%");let T=class T{constructor(e,o){this.tag=e,this.value=o}static some(e){return new T(!0,e)}static none(){return T.singletonNone}fold(e,o){return this.tag?o(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(e){return this.tag?T.some(e(this.value)):T.none()}bind(e){return this.tag?e(this.value):T.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(e){return!this.tag||e(this.value)?this:T.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw Error(null!=e?e:"Called getOrDie on None")}static from(e){return null==e?T.none():T.some(e)}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}};T.singletonNone=new T(!1);let H=Object.hasOwnProperty;var L=tinymce.util.Tools.resolve("tinymce.html.Serializer");let j={'"':"&quot;","<":"&lt;",">":"&gt;","&":"&amp;","'":"&#039;"},w=e=>e.replace(/["'<>&]/g,e=>(H.call(j,e)?T.from(j[e]):T.none()).getOr(e)),O=(e,o,u)=>((u,m)=>{var p;for(let m=0,d=u.length;m<d;m++)if(p=u[m],e.hasClass(o,p))return!0;return!1})(u.split(/\s+/)),A=(e,o)=>L({validate:!0},e.schema).serialize(e.parser.parse(o,{insert:!0})),D=(e,o)=>(p.each(o,(o,u)=>{s(o)&&(o=o(u)),e=e.replace(RegExp("\\{\\$"+u.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")+"\\}","g"),o)}),e),N=(e,o)=>{let u=e.dom,m=y(e);p.each(u.select("*",o),e=>{p.each(m,(o,m)=>{u.hasClass(e,m)&&s(o)&&o(e)})})},I=(e,o,u)=>{let m=e.dom,v=e.selection.getContent();u=D(u,y(e));let f=m.create("div",{},A(e,u)),x=m.select(".mceTmpl",f);x&&x.length>0&&(f=m.create("div")).appendChild(x[0].cloneNode(!0)),p.each(m.select("*",f),o=>{O(m,o,d(e))&&(o.innerHTML=M(e,b(e))),O(m,o,h(e))&&(o.innerHTML=M(e,S(e))),O(m,o,g(e))&&(o.innerHTML=v)}),N(e,f),e.execCommand("mceInsertContent",!1,f.innerHTML),e.addVisual()};var Y=tinymce.util.Tools.resolve("tinymce.Env");let k=(e,o)=>{let a=(e,o)=>((e,o,u)=>{for(let m=0,p=e.length;m<p;m++){let p=e[m];if(o(p,m))return T.some(p);if(u(p,m))break}return T.none()})(e,e=>e.text===o,l),n=o=>{e.windowManager.alert("Could not load the specified template.",()=>o.focus("template"))},r=e=>e.value.url.fold(()=>Promise.resolve(e.value.content.getOr("")),e=>fetch(e).then(e=>e.ok?e.text():Promise.reject())),s=(e,o)=>(u,m)=>{if("template"===m.name){let m=u.getData().template;a(e,m).each(e=>{u.block("Loading..."),r(e).then(m=>{o(u,e,m)}).catch(()=>{o(u,e,""),u.setEnabled("save",!1),n(u)})})}},c=o=>u=>{let m=u.getData();a(o,m.template).each(o=>{r(o).then(o=>{e.execCommand("mceInsertTemplate",!1,o),u.close()}).catch(()=>{u.setEnabled("save",!1),n(u)})})};(()=>{if(!o||0===o.length){let o=e.translate("No templates defined.");return e.notificationManager.open({text:o,type:"info"}),T.none()}return T.from(p.map(o,(e,o)=>({selected:0===o,text:e.title,value:{url:void 0!==e.url?T.from(e.url):T.none(),content:void 0!==e.url?T.none():T.from(e.content),description:e.description}})))})().each(o=>{let u=((e,o)=>{let u=e.length,m=Array(u);for(let o=0;o<u;o++){let u=e[o];m[o]={text:u.text,value:u.text}}return m})(o),l=(e,u)=>({title:"Insert Template",size:"large",body:{type:"panel",items:e},initialData:u,buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],onSubmit:c(o),onChange:s(o,i)}),i=(o,m,d)=>{let h=((e,o)=>{var u;let m=A(e,o);if(-1===o.indexOf("<html>")){let o="",d=null!==(u=x(e))&&void 0!==u?u:"",h=C(e)?' crossorigin="anonymous"':"";p.each(e.contentCSS,u=>{o+='<link type="text/css" rel="stylesheet" href="'+e.documentBaseURI.toAbsolute(u)+'"'+h+">"}),d&&(o+='<style type="text/css">'+d+"</style>");let g=E(e),v=e.dom.encode,y='<script>document.addEventListener && document.addEventListener("click", function(e) {for (var elm = e.target; elm; elm = elm.parentNode) {if (elm.nodeName === "A" && !('+(Y.os.isMacOS()||Y.os.isiOS()?"e.metaKey":"e.ctrlKey && !e.altKey")+")) {e.preventDefault();}}}, false);</script> ",f=e.getBody().dir,b=f?' dir="'+v(f)+'"':"";m='<!DOCTYPE html><html><head><base href="'+v(e.documentBaseURI.getURI())+'">'+o+y+'</head><body class="'+v(g)+'"'+b+">"+m+"</body></html>"}return D(m,v(e))})(e,d),g=[{type:"listbox",name:"template",label:"Templates",items:u},{type:"htmlpanel",html:`<p aria-live="polite">${w(m.value.description)}</p>`},{label:"Preview",type:"iframe",name:"preview",sandboxed:!1,transparent:!1}],y={template:m.text,preview:h};o.unblock(),o.redial(l(g,y)),o.focus("template")},m=e.windowManager.open(l([],{template:"",preview:""}));m.block("Loading..."),r(o[0]).then(e=>{i(m,o[0],e)}).catch(()=>{i(m,o[0],""),m.setEnabled("save",!1),n(m)})})},P=e=>o=>{let a=()=>{o.setEnabled(e.selection.isEditable())};return e.on("NodeChange",a),a(),()=>{e.off("NodeChange",a)}};e.add("template",e=>{var d;(e=>{let p=e.options.register;p("template_cdate_classes",{processor:"string",default:"cdate"}),p("template_mdate_classes",{processor:"string",default:"mdate"}),p("template_selected_content_classes",{processor:"string",default:"selcontent"}),p("template_preview_replace_values",{processor:"object"}),p("template_replace_values",{processor:"object"}),p("templates",{processor:e=>o(e)||((e,o)=>{if(m(e)){for(let u=0,m=e.length;u<m;++u)if(!o(e[u]))return!1;return!0}return!1})(e,u)||s(e),default:[]}),p("template_cdate_format",{processor:"string",default:e.translate("%Y-%m-%d")}),p("template_mdate_format",{processor:"string",default:e.translate("%Y-%m-%d")})})(e),(e=>{let t=()=>e.execCommand("mceTemplate");e.ui.registry.addButton("template",{icon:"template",tooltip:"Insert template",onSetup:P(e),onAction:t}),e.ui.registry.addMenuItem("template",{icon:"template",text:"Insert template...",onSetup:P(e),onAction:t})})(e),e.addCommand("mceInsertTemplate",function(e,...o){return(...u)=>{let m=o.concat(u);return e.apply(null,m)}}(I,e)),e.addCommand("mceTemplate",(d=o=>{k(e,o)},()=>{let u=f(e);s(u)?u(d):o(u)?fetch(u).then(e=>{e.ok&&e.json().then(d)}):d(u)})),(e=>{e.on("PreProcess",o=>{let u=e.dom,m=S(e);p.each(u.select("div",o.node),o=>{u.hasClass(o,"mceTmpl")&&(p.each(u.select("*",o),o=>{O(u,o,h(e))&&(o.innerHTML=M(e,m))}),N(e,o))})})})(e)})}();