!function(){"use strict";var e=tinymce.util.Tools.resolve("tinymce.PluginManager");let hasProto=(e,t,r)=>{var o;return!!r(e,t.prototype)||(null===(o=e.constructor)||void 0===o?void 0:o.name)===t.name},typeOf=e=>{let t=typeof e;return null===e?"null":"object"===t&&Array.isArray(e)?"array":"object"===t&&hasProto(e,String,(e,t)=>t.isPrototypeOf(e))?"string":t},isType=e=>t=>typeOf(t)===e,t=isType("string"),r=isType("object"),o=isType("array"),isFunction=e=>"function"==typeof e;var s=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),i=tinymce.util.Tools.resolve("tinymce.EditorManager"),l=tinymce.util.Tools.resolve("tinymce.Env"),n=tinymce.util.Tools.resolve("tinymce.util.Tools");let option=e=>t=>t.options.get(e),register=e=>{let o=e.options.register,filterProcessor=e=>t(e)||isFunction(e)||r(e);o("importcss_merge_classes",{processor:"boolean",default:!0}),o("importcss_exclusive",{processor:"boolean",default:!0}),o("importcss_selector_converter",{processor:"function"}),o("importcss_selector_filter",{processor:filterProcessor}),o("importcss_file_filter",{processor:filterProcessor}),o("importcss_groups",{processor:"object[]"}),o("importcss_append",{processor:"boolean",default:!1})},c=option("importcss_merge_classes"),a=option("importcss_exclusive"),p=option("importcss_selector_converter"),u=option("importcss_selector_filter"),m=option("importcss_groups"),f=option("importcss_append"),d=option("importcss_file_filter"),g=option("skin"),y=option("skin_url"),h=Array.prototype.push,map=(e,t)=>{let r=e.length,o=Array(r);for(let s=0;s<r;s++){let r=e[s];o[s]=t(r,s)}return o},flatten=e=>{let t=[];for(let r=0,s=e.length;r<s;++r){if(!o(e[r]))throw Error("Arr.flatten item "+r+" was not an array, input: "+e);h.apply(t,e[r])}return t},bind=(e,t)=>flatten(map(e,t)),generate=()=>{let e=[],t=[],r={};return{addItemToGroup:(e,o)=>{r[e]?r[e].push(o):(t.push(e),r[e]=[o])},addItem:t=>{e.push(t)},toFormats:()=>{let o=bind(t,e=>{let t=r[e];return 0===t.length?[]:[{title:e,items:t}]});return o.concat(e)}}},S=/^\.(?:ephox|tiny-pageembed|mce)(?:[.-]+\w+)+$/,removeCacheSuffix=e=>{let r=l.cacheSuffix;return t(e)&&(e=e.replace("?"+r,"").replace("&"+r,"")),e},isSkinContentCss=(e,t)=>{let r=g(e);if(r){let o=y(e),s=o?e.documentBaseURI.toAbsolute(o):i.baseURL+"/skins/ui/"+r,l=i.baseURL+"/skins/content/";return t===s+"/content"+(e.inline?".inline":"")+".min.css"||-1!==t.indexOf(l)}return!1},compileFilter=e=>t(e)?t=>-1!==t.indexOf(e):e instanceof RegExp?t=>e.test(t):e,isCssImportRule=e=>e.styleSheet,isCssPageRule=e=>e.selectorText,getSelectors=(e,t,r)=>{let o=[],s={},append=(t,s)=>{let i,l=t.href;if(!(!(l=removeCacheSuffix(l))||r&&!r(l,s)||isSkinContentCss(e,l))){n.each(t.imports,e=>{append(e,!0)});try{i=t.cssRules||t.rules}catch(e){}n.each(i,e=>{isCssImportRule(e)?append(e.styleSheet,!0):isCssPageRule(e)&&n.each(e.selectorText.split(","),e=>{o.push(n.trim(e))})})}};n.each(e.contentCSS,e=>{s[e]=!0}),r||(r=(e,t)=>t||s[e]);try{n.each(t.styleSheets,e=>{append(e)})}catch(e){}return o},defaultConvertSelectorToFormat=(e,t)=>{let r={},o=/^(?:([a-z0-9\-_]+))?(\.[a-z0-9_\-\.]+)$/i.exec(t);if(!o)return;let s=o[1],i=o[2].substr(1).split(".").join(" "),l=n.makeMap("a,img");return o[1]?(r={title:t},e.schema.getTextBlockElements()[s]?r.block=s:e.schema.getBlockElements()[s]||l[s.toLowerCase()]?r.selector=s:r.inline=s):o[2]&&(r={inline:"span",title:t.substr(1),classes:i}),c(e)?r.classes=i:r.attributes={class:i},r},getGroupsBySelector=(e,t)=>n.grep(e,e=>!e.filter||e.filter(t)),compileUserDefinedGroups=e=>n.map(e,e=>n.extend({},e,{original:e,selectors:{},filter:compileFilter(e.filter)})),isExclusiveMode=(e,t)=>null===t||a(e),isUniqueSelector=(e,t,r,o)=>!(isExclusiveMode(e,r)?t in o:t in r.selectors),markUniqueSelector=(e,t,r,o)=>{isExclusiveMode(e,r)?o[t]=!0:r.selectors[t]=!0},convertSelectorToFormat=(e,t,r,o)=>{let s=p(e);return(o&&o.selector_converter?o.selector_converter:s||(()=>defaultConvertSelectorToFormat(e,r))).call(t,r,o)},setup=e=>{e.on("init",()=>{let t=generate(),r={},o=compileFilter(u(e)),i=compileUserDefinedGroups(m(e)),processSelector=(t,o)=>{if(isUniqueSelector(e,t,o,r)){markUniqueSelector(e,t,o,r);let i=convertSelectorToFormat(e,e.plugins.importcss,t,o);if(i){let t=i.name||s.DOM.uniqueId();return e.formatter.register(t,i),{title:i.title,format:t}}}return null};n.each(getSelectors(e,e.getDoc(),compileFilter(d(e))),e=>{if(!S.test(e)&&(!o||o(e))){let r=getGroupsBySelector(i,e);if(r.length>0)n.each(r,r=>{let o=processSelector(e,r);o&&t.addItemToGroup(r.title,o)});else{let r=processSelector(e,null);r&&t.addItem(r)}}});let l=t.toFormats();e.dispatch("addStyleModifications",{items:l,replace:!f(e)})})},get=e=>({convertSelectorToFormat:t=>defaultConvertSelectorToFormat(e,t)});e.add("importcss",e=>(register(e),setup(e),get(e)))}();