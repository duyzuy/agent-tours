!function(){"use strict";var e=tinymce.util.Tools.resolve("tinymce.PluginManager");let t=e=>o=>(e=>{var o,m;let u=typeof e;return null===e?"null":"object"===u&&Array.isArray(e)?"array":"object"===u&&((o=String).prototype.isPrototypeOf(e)||(null===(m=e.constructor)||void 0===m?void 0:m.name)===o.name)?"string":u})(o)===e,o=t("string"),m=t("object"),u=t("array"),s=e=>null!=e;let i=class i{constructor(e,o){this.tag=e,this.value=o}static some(e){return new i(!0,e)}static none(){return i.singletonNone}fold(e,o){return this.tag?o(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(e){return this.tag?i.some(e(this.value)):i.none()}bind(e){return this.tag?e(this.value):i.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(e){return!this.tag||e(this.value)?this:i.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw Error(null!=e?e:"Called getOrDie on None")}static from(e){return s(e)?i.some(e):i.none()}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}};i.singletonNone=new i(!1);let g=Array.prototype.push,l=(e,o)=>{for(let m=0,u=e.length;m<u;m++)o(e[m],m)},c=e=>{let o=[];for(let m=0,b=e.length;m<b;++m){if(!u(e[m]))throw Error("Arr.flatten item "+m+" was not an array, input: "+e);g.apply(o,e[m])}return o},b=Object.keys,w=Object.hasOwnProperty,d=(e,o)=>h(e,o)?i.from(e[o]):i.none(),h=(e,o)=>w.call(e,o),p=e=>o=>o.options.get(e),v=p("audio_template_callback"),f=p("video_template_callback"),y=p("iframe_template_callback"),x=p("media_live_embeds"),_=p("media_filter_html"),k=p("media_url_resolver"),j=p("media_alt_source"),O=p("media_poster"),A=p("media_dimensions");var S=tinymce.util.Tools.resolve("tinymce.util.Tools"),D=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),F=tinymce.util.Tools.resolve("tinymce.html.DomParser");let N=D.DOM,$=e=>e.replace(/px$/,""),C=e=>{let o=e.attr("style"),m=o?N.parseStyle(o):{};return{type:"ephox-embed-iri",source:e.attr("data-ephox-embed-iri"),altsource:"",poster:"",width:d(m,"max-width").map($).getOr(""),height:d(m,"max-height").map($).getOr("")}},T=(e,o)=>{let m={};for(let u=F({validate:!1,forced_root_block:!1},o).parse(e);u;u=u.walk())if(1===u.type){let e=u.name;if(u.attr("data-ephox-embed-iri")){m=C(u);break}m.source||"param"!==e||(m.source=u.attr("movie")),"iframe"!==e&&"object"!==e&&"embed"!==e&&"video"!==e&&"audio"!==e||(m.type||(m.type=e),m=S.extend(u.attributes.map,m)),"source"===e&&(m.source?m.altsource||(m.altsource=u.attr("src")):m.source=u.attr("src")),"img"!==e||m.poster||(m.poster=u.attr("src"))}return m.source=m.source||m.src||"",m.altsource=m.altsource||"",m.poster=m.poster||"",m},z=e=>{var o;let m=null!==(o=e.toLowerCase().split(".").pop())&&void 0!==o?o:"";return d({mp3:"audio/mpeg",m4a:"audio/x-m4a",wav:"audio/wav",mp4:"video/mp4",webm:"video/webm",ogg:"video/ogg",swf:"application/x-shockwave-flash"},m).getOr("")};var U=tinymce.util.Tools.resolve("tinymce.html.Node"),L=tinymce.util.Tools.resolve("tinymce.html.Serializer");let M=(e,o={})=>F({forced_root_block:!1,validate:!1,allow_conditional_comments:!0,...o},e),q=D.DOM,R=e=>/^[0-9.]+$/.test(e)?e+"px":e,E=(e,o)=>{let m=o.attr("style"),u=m?q.parseStyle(m):{};s(e.width)&&(u["max-width"]=R(e.width)),s(e.height)&&(u["max-height"]=R(e.height)),o.attr("style",q.serializeStyle(u))},et=["source","altsource"],P=(e,o,m,u)=>{let g=0,b=0,w=M(u);w.addNodeFilter("source",e=>g=e.length);let v=w.parse(e);for(let e=v;e;e=e.walk())if(1===e.type){let u=e.name;if(e.attr("data-ephox-embed-iri")){E(o,e);break}switch(u){case"video":case"object":case"embed":case"img":case"iframe":void 0!==o.height&&void 0!==o.width&&(e.attr("width",o.width),e.attr("height",o.height))}if(m)switch(u){case"video":e.attr("poster",o.poster),e.attr("src",null);for(let m=g;m<2;m++)if(o[et[m]]){let u=new U("source",1);u.attr("src",o[et[m]]),u.attr("type",o[et[m]+"mime"]||null),e.append(u)}break;case"iframe":e.attr("src",o.source);break;case"object":let w=e.getAll("img").length>0;if(o.poster&&!w){e.attr("src",o.poster);let m=new U("img",1);m.attr("src",o.poster),m.attr("width",o.width),m.attr("height",o.height),e.append(m)}break;case"source":if(b<2&&(e.attr("src",o[et[b]]),e.attr("type",o[et[b]+"mime"]||null),!o[et[b]])){e.remove();continue}b++;break;case"img":o.poster||e.remove()}}return L({},u).serialize(v)},er=[{regex:/youtu\.be\/([\w\-_\?&=.]+)/i,type:"iframe",w:560,h:314,url:"www.youtube.com/embed/$1",allowFullscreen:!0},{regex:/youtube\.com(.+)v=([^&]+)(&([a-z0-9&=\-_]+))?/i,type:"iframe",w:560,h:314,url:"www.youtube.com/embed/$2?$4",allowFullscreen:!0},{regex:/youtube.com\/embed\/([a-z0-9\?&=\-_]+)/i,type:"iframe",w:560,h:314,url:"www.youtube.com/embed/$1",allowFullscreen:!0},{regex:/vimeo\.com\/([0-9]+)\?h=(\w+)/,type:"iframe",w:425,h:350,url:"player.vimeo.com/video/$1?h=$2&title=0&byline=0&portrait=0&color=8dc7dc",allowFullscreen:!0},{regex:/vimeo\.com\/(.*)\/([0-9]+)\?h=(\w+)/,type:"iframe",w:425,h:350,url:"player.vimeo.com/video/$2?h=$3&title=0&amp;byline=0",allowFullscreen:!0},{regex:/vimeo\.com\/([0-9]+)/,type:"iframe",w:425,h:350,url:"player.vimeo.com/video/$1?title=0&byline=0&portrait=0&color=8dc7dc",allowFullscreen:!0},{regex:/vimeo\.com\/(.*)\/([0-9]+)/,type:"iframe",w:425,h:350,url:"player.vimeo.com/video/$2?title=0&amp;byline=0",allowFullscreen:!0},{regex:/maps\.google\.([a-z]{2,3})\/maps\/(.+)msid=(.+)/,type:"iframe",w:425,h:350,url:'maps.google.com/maps/ms?msid=$2&output=embed"',allowFullscreen:!1},{regex:/dailymotion\.com\/video\/([^_]+)/,type:"iframe",w:480,h:270,url:"www.dailymotion.com/embed/video/$1",allowFullscreen:!0},{regex:/dai\.ly\/([^_]+)/,type:"iframe",w:480,h:270,url:"www.dailymotion.com/embed/video/$1",allowFullscreen:!0}],I=(e,o)=>{let m=(e=>{let o=e.match(/^(https?:\/\/|www\.)(.+)$/i);return o&&o.length>1?"www."===o[1]?"https://":o[1]:"https://"})(o),u=e.regex.exec(o),g=m+e.url;if(s(u))for(let e=0;e<u.length;e++)g=g.replace("$"+e,()=>u[e]?u[e]:"");return g.replace(/\?$/,"")},B=e=>{let o=er.filter(o=>o.regex.test(e));return o.length>0?S.extend({},o[0],{url:I(o[0],e)}):null},G=(e,o)=>{var m;let u=S.extend({},o);if(!u.source&&(S.extend(u,T(null!==(m=u.embed)&&void 0!==m?m:"",e.schema)),!u.source))return"";u.altsource||(u.altsource=""),u.poster||(u.poster=""),u.source=e.convertURL(u.source,"source"),u.altsource=e.convertURL(u.altsource,"source"),u.sourcemime=z(u.source),u.altsourcemime=z(u.altsource),u.poster=e.convertURL(u.poster,"poster");let g=B(u.source);if(g&&(u.source=g.url,u.type=g.type,u.allowfullscreen=g.allowFullscreen,u.width=u.width||String(g.w),u.height=u.height||String(g.h)),u.embed)return P(u.embed,u,!0,e.schema);{let o;let m=v(e),g=f(e),b=y(e);return u.width=u.width||"300",u.height=u.height||"150",S.each(u,(o,m)=>{u[m]=e.dom.encode(""+o)}),"iframe"===u.type?((e,o)=>{if(o)return o(e);{let o=e.allowfullscreen?' allowFullscreen="1"':"";return'<iframe src="'+e.source+'" width="'+e.width+'" height="'+e.height+'"'+o+"></iframe>"}})(u,b):"application/x-shockwave-flash"===u.sourcemime?(o='<object data="'+u.source+'" width="'+u.width+'" height="'+u.height+'" type="application/x-shockwave-flash">',u.poster&&(o+='<img src="'+u.poster+'" width="'+u.width+'" height="'+u.height+'" />'),o+="</object>"):-1!==u.sourcemime.indexOf("audio")?m?m(u):'<audio controls="controls" src="'+u.source+'">'+(u.altsource?'\n<source src="'+u.altsource+'"'+(u.altsourcemime?' type="'+u.altsourcemime+'"':"")+" />\n":"")+"</audio>":g?g(u):'<video width="'+u.width+'" height="'+u.height+'"'+(u.poster?' poster="'+u.poster+'"':"")+' controls="controls">\n<source src="'+u.source+'"'+(u.sourcemime?' type="'+u.sourcemime+'"':"")+" />\n"+(u.altsource?'<source src="'+u.altsource+'"'+(u.altsourcemime?' type="'+u.altsourcemime+'"':"")+" />\n":"")+"</video>"}},W=e=>e.hasAttribute("data-mce-object")||e.hasAttribute("data-ephox-embed-iri"),ea={},H=e=>o=>G(e,o),J=(e,o)=>{var m;let u=k(e);return u?(m=H(e),new Promise((e,g)=>{let s=u=>(u.html&&(ea[o.source]=u),e({url:o.source,html:u.html?u.html:m(o)}));ea[o.source]?s(ea[o.source]):u({url:o.source},s,g)})):Promise.resolve({html:H(e)(o),url:o.source})},K=(e,o)=>{let m={};return d(e,"dimensions").each(e=>{l(["width","height"],u=>{d(o,u).orThunk(()=>d(e,u)).each(e=>m[u]=e)})}),m},Q=(e,o)=>{let u=o&&"dimensions"!==o?d(e,o).bind(e=>d(e,"meta")).getOr({}):{},a=g=>{let s=()=>d(e,g),n=()=>d(u,g),l=e=>d(e,"value").bind(e=>e.length>0?i.some(e):i.none());return{[g]:(g===o?s().bind(e=>m(e)?l(e).orThunk(n):n().orThunk(()=>i.from(e))):n().orThunk(()=>s().bind(e=>m(e)?l(e):i.from(e)))).getOr("")}};return{...a("source"),...a("altsource"),...a("poster"),...a("embed"),...K(e,u)}},V=e=>{let o={...e,source:{value:d(e,"source").getOr("")},altsource:{value:d(e,"altsource").getOr("")},poster:{value:d(e,"poster").getOr("")}};return l(["width","height"],m=>{d(e,m).each(e=>{let u=o.dimensions||{};u[m]=e,o.dimensions=u})}),o},X=e=>o=>{let m=o&&o.msg?"Media embed handler error: "+o.msg:"Media embed handler threw unknown error.";e.notificationManager.open({type:"error",text:m})},Y=(e,m)=>u=>{if(o(u.url)&&u.url.trim().length>0){let o=u.html,g={...T(o,m.schema),source:u.url,embed:o};e.setData(V(g))}},Z=(e,o)=>{let m=e.dom.select("*[data-mce-object]");e.insertContent(o),((e,o)=>{let m=e.dom.select("*[data-mce-object]");for(let e=0;e<o.length;e++)for(let u=m.length-1;u>=0;u--)o[e]===m[u]&&m.splice(u,1);e.selection.select(m[0])})(e,m),e.nodeChanged()},ee=(e,o)=>s(o)&&"ephox-embed-iri"===o&&s(B(e)),te=(e,o)=>(e.width!==o.width||e.height!==o.height)&&ee(o.source,e.type),re=e=>{let o;let m=(e=>{let o=e.selection.getNode(),m=W(o)?e.serializer.serialize(o,{selection:!0}):"",u=T(m,e.schema),g=(()=>{if(ee(u.source,u.type)){let m=e.dom.getRect(o);return{width:m.w.toString().replace(/px$/,""),height:m.h.toString().replace(/px$/,"")}}return{}})();return{embed:m,...u,...g}})(e),u=(o=m,{get:()=>o,set:e=>{o=e}}),g=V(m),b=A(e)?[{type:"sizeinput",name:"dimensions",label:"Constrain proportions",constrain:!0}]:[],w={title:"General",name:"general",items:c([[{name:"source",type:"urlinput",filetype:"media",label:"Source"}],b])},v=[];j(e)&&v.push({name:"altsource",type:"urlinput",filetype:"media",label:"Alternative source URL"}),O(e)&&v.push({name:"poster",type:"urlinput",filetype:"image",label:"Media poster (Image URL)"});let f=[w,{title:"Embed",items:[{type:"textarea",name:"embed",label:"Paste your embed code below:"}]}];v.length>0&&f.push({title:"Advanced",name:"advanced",items:v});let y=e.windowManager.open({title:"Insert/Edit Media",size:"normal",body:{type:"tabpanel",tabs:f},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],onSubmit:o=>{var m,g;let b=Q(o.getData());m=u.get(),b.embed=te(m,b)&&A(e)?G(e,{...b,embed:""}):P(null!==(g=b.embed)&&void 0!==g?g:"",b,!1,e.schema),b.embed&&(m.source===b.source||h(ea,b.source))?Z(e,b.embed):J(e,b).then(o=>{Z(e,o.html)}).catch(X(e)),o.close()},onChange:(o,m)=>{switch(m.name){case"source":((o,m)=>{let u=Q(m.getData(),"source");o.source!==u.source&&(Y(y,e)({url:u.source,html:""}),J(e,u).then(Y(y,e)).catch(X(e)))})(u.get(),o);break;case"embed":(o=>{var m;let u=Q(o.getData()),g=T(null!==(m=u.embed)&&void 0!==m?m:"",e.schema);o.setData(V(g))})(o);break;case"dimensions":case"altsource":case"poster":((o,m,u)=>{let g=Q(o.getData(),m),b=te(u,g)&&A(e)?{...g,embed:""}:g,w=G(e,b);o.setData(V({...b,embed:w}))})(o,m.name,u.get())}u.set(Q(o.getData()))},initialData:g})};var el=tinymce.util.Tools.resolve("tinymce.Env");let ae=e=>{let o=e.name;return"iframe"===o||"video"===o||"audio"===o},se=(e,o,m,u=null)=>{let g=e.attr(m);return s(g)?g:h(o,m)?null:u},ie=(e,o,m)=>{let u="img"===o.name||"video"===e.name,g="audio"===e.name?"30":"150",b=u?g:null;o.attr({width:se(e,m,"width",u?"300":null),height:se(e,m,"height",b)})},ne=(e,o)=>{let m=o.name,u=new U("img",1);return ce(e,o,u),ie(o,u,{}),u.attr({style:o.attr("style"),src:el.transparentSrc,"data-mce-object":m,class:"mce-object mce-object-"+m}),u},le=(e,o)=>{var m;let u=o.name,g=new U("span",1);g.attr({contentEditable:"false",style:o.attr("style"),"data-mce-object":u,class:"mce-preview-object mce-object-"+u}),ce(e,o,g);let b=e.dom.parseStyle(null!==(m=o.attr("style"))&&void 0!==m?m:""),w=new U(u,1);if(ie(o,w,b),w.attr({src:o.attr("src"),style:o.attr("style"),class:o.attr("class")}),"iframe"===u)w.attr({allowfullscreen:o.attr("allowfullscreen"),frameborder:"0"});else{l(["controls","crossorigin","currentTime","loop","muted","poster","preload"],e=>{w.attr(e,o.attr(e))});let m=g.attr("data-mce-html");s(m)&&((e,o,m,u)=>{let g=M(e.schema).parse(u,{context:o});for(;g.firstChild;)m.append(g.firstChild)})(e,u,w,unescape(m))}let v=new U("span",1);return v.attr("class","mce-shim"),g.append(w),g.append(v),g},ce=(e,o,m)=>{var u;let g=null!==(u=o.attributes)&&void 0!==u?u:[],b=g.length;for(;b--;){let o=g[b].name,u=g[b].value;"width"===o||"height"===o||"style"===o||o.length>=9&&"data-mce-"===o.substr(0,9)||("data"!==o&&"src"!==o||(u=e.convertURL(u,o)),m.attr("data-mce-p-"+o,u))}let w=L({inner:!0},e.schema),v=new U("div",1);l(o.children(),e=>v.append(e));let f=w.serialize(v);f&&(m.attr("data-mce-html",escape(f)),m.empty())},me=e=>{let m=e.attr("class");return o(m)&&/\btiny-pageembed\b/.test(m)},ue=e=>{let o=e;for(;o=o.parent;)if(o.attr("data-ephox-embed-iri")||me(o))return!0;return!1},de=(e,o,m)=>{let u=(0,e.options.get)("xss_sanitization"),g=_(e);return M(e.schema,{sanitize:u,validate:g}).parse(m,{context:o})},he=e=>o=>{let r=()=>{o.setEnabled(e.selection.isEditable())};return e.on("NodeChange",r),r(),()=>{e.off("NodeChange",r)}};e.add("media",e=>((e=>{let o=e.options.register;o("audio_template_callback",{processor:"function"}),o("video_template_callback",{processor:"function"}),o("iframe_template_callback",{processor:"function"}),o("media_live_embeds",{processor:"boolean",default:!0}),o("media_filter_html",{processor:"boolean",default:!0}),o("media_url_resolver",{processor:"function"}),o("media_alt_source",{processor:"boolean",default:!0}),o("media_poster",{processor:"boolean",default:!0}),o("media_dimensions",{processor:"boolean",default:!0})})(e),(e=>{e.addCommand("mceMedia",()=>{re(e)})})(e),(e=>{let t=()=>e.execCommand("mceMedia");e.ui.registry.addToggleButton("media",{tooltip:"Insert/edit media",icon:"embed",onAction:t,onSetup:o=>{let m=e.selection;o.setActive(W(m.getNode()));let u=m.selectorChangedWithUnbind("img[data-mce-object],span[data-mce-object],div[data-ephox-embed-iri]",o.setActive).unbind,g=he(e)(o);return()=>{u(),g()}}}),e.ui.registry.addMenuItem("media",{icon:"embed",text:"Media...",onAction:t,onSetup:he(e)})})(e),(e=>{e.on("ResolveName",e=>{let o;1===e.target.nodeType&&(o=e.target.getAttribute("data-mce-object"))&&(e.name=o)})})(e),e.on("PreInit",()=>{let{schema:o,serializer:m,parser:u}=e,g=o.getBoolAttrs();l("webkitallowfullscreen mozallowfullscreen".split(" "),e=>{g[e]={}}),((e,o)=>{let m=b(e);for(let u=0,g=m.length;u<g;u++){let g=m[u];o(e[g],g)}})({embed:["wmode"]},(e,m)=>{let u=o.getElementRule(m);u&&l(e,e=>{u.attributes[e]={},u.attributesOrder.push(e)})}),u.addNodeFilter("iframe,video,audio,object,embed",o=>{let m,u=o.length;for(;u--;)(m=o[u]).parent&&(m.parent.attr("data-mce-object")||(ae(m)&&x(e)?ue(m)||m.replace(le(e,m)):ue(m)||m.replace(ne(e,m))))}),m.addAttributeFilter("data-mce-object",(o,m)=>{var u;let g=o.length;for(;g--;){let b=o[g];if(!b.parent)continue;let w=b.attr(m),v=new U(w,1);if("audio"!==w){let e=b.attr("class");e&&-1!==e.indexOf("mce-preview-object")&&b.firstChild?v.attr({width:b.firstChild.attr("width"),height:b.firstChild.attr("height")}):v.attr({width:b.attr("width"),height:b.attr("height")})}v.attr({style:b.attr("style")});let f=null!==(u=b.attributes)&&void 0!==u?u:[],y=f.length;for(;y--;){let e=f[y].name;0===e.indexOf("data-mce-p-")&&v.attr(e.substr(11),f[y].value)}let x=b.attr("data-mce-html");if(x){let o=de(e,w,unescape(x));l(o.children(),e=>v.append(e))}b.replace(v)}})}),e.on("SetContent",()=>{let o=e.dom;l(o.select("span.mce-preview-object"),e=>{0===o.select("span.mce-shim",e).length&&o.add(e,"span",{class:"mce-shim"})})}),e.on("click keyup touchend",()=>{let o=e.selection.getNode();o&&e.dom.hasClass(o,"mce-preview-object")&&e.dom.getAttrib(o,"data-mce-selected")&&o.setAttribute("data-mce-selected","2")}),e.on("ObjectResized",o=>{let m=o.target;if(m.getAttribute("data-mce-object")){let u=m.getAttribute("data-mce-html");u&&(u=unescape(u),m.setAttribute("data-mce-html",escape(P(u,{width:String(o.width),height:String(o.height)},!1,e.schema))))}}),{showDialog:()=>{re(e)}}))}();