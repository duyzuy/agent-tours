!function(){"use strict";let e=t=>{let r=t;return{get:()=>r,set:t=>{r=t}}};var t=tinymce.util.Tools.resolve("tinymce.PluginManager");let n=t=>r=>(t=>{var r,m;let g=typeof t;return null===t?"null":"object"===g&&Array.isArray(t)?"array":"object"===g&&((r=String).prototype.isPrototypeOf(t)||(null===(m=t.constructor)||void 0===m?void 0:m.name)===r.name)?"string":g})(r)===t,o=t=>r=>typeof r===t,r=n("string"),m=n("array"),g=o("boolean"),f=o("number"),i=()=>{},c=t=>()=>t,p=c(!0),C=c("[~№|!-*+-\\/:;?@\\[-`{}\xa1\xab\xb7\xbb\xbf;\xb7՚-՟։֊־׀׃׆׳״؉؊،؍؛؞؟٪-٭۔܀-܍߷-߹࠰-࠾࡞।॥॰෴๏๚๛༄-༒༺-༽྅࿐-࿔࿙࿚၊-၏჻፡-፨᐀᙭᙮᚛᚜᛫-᛭᜵᜶។-៖៘-៚᠀-᠊᥄᥅᨞᨟᪠-᪦᪨-᪭᭚-᭠᯼-᯿᰻-᰿᱾᱿᳓‐-‧‰-⁃⁅-⁑⁓-⁞⁽⁾₍₎〈〉❨-❵⟅⟆⟦-⟯⦃-⦘⧘-⧛⧼⧽⳹-⳼⳾⳿⵰⸀-⸮⸰⸱、-〃〈-】〔-〟〰〽゠・꓾꓿꘍-꘏꙳꙾꛲-꛷꡴-꡷꣎꣏꣸-꣺꤮꤯꥟꧁-꧍꧞꧟꩜-꩟꫞꫟꯫﴾﴿︐-︙︰-﹒﹔-﹡﹣﹨﹪﹫！-＃％-＊，-／：；？＠［-］＿｛｝｟-･]");let h=class h{constructor(t,r){this.tag=t,this.value=r}static some(t){return new h(!0,t)}static none(){return h.singletonNone}fold(t,r){return this.tag?r(this.value):t()}isSome(){return this.tag}isNone(){return!this.tag}map(t){return this.tag?h.some(t(this.value)):h.none()}bind(t){return this.tag?t(this.value):h.none()}exists(t){return this.tag&&t(this.value)}forall(t){return!this.tag||t(this.value)}filter(t){return!this.tag||t(this.value)?this:h.none()}getOr(t){return this.tag?this.value:t}or(t){return this.tag?this:t}getOrThunk(t){return this.tag?this.value:t()}orThunk(t){return this.tag?this:t()}getOrDie(t){if(this.tag)return this.value;throw Error(null!=t?t:"Called getOrDie on None")}static from(t){return null==t?h.none():h.some(t)}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(t){this.tag&&t(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}};h.singletonNone=new h(!1);var O=tinymce.util.Tools.resolve("tinymce.Env"),N=tinymce.util.Tools.resolve("tinymce.util.Tools");let S=Array.prototype.slice,F=Array.prototype.push,y=(t,r)=>{let m=t.length,g=Array(m);for(let f=0;f<m;f++){let m=t[f];g[f]=r(m,f)}return g},w=(t,r)=>{for(let m=0,g=t.length;m<g;m++)r(t[m],m)},b=(t,r)=>{for(let m=t.length-1;m>=0;m--)r(t[m],m)},v=(t,r)=>(t=>{let r=[];for(let g=0,f=t.length;g<f;++g){if(!m(t[g]))throw Error("Arr.flatten item "+g+" was not an array, input: "+t);F.apply(r,t[g])}return r})(y(t,r)),et=Object.hasOwnProperty,E=(t,r)=>et.call(t,r);"undefined"!=typeof window?window:Function("return this;")();let T=t=>{if(null==t)throw Error("Node cannot be null or undefined");return{dom:t}},k=(t,r)=>({element:t,offset:r}),A=(t,r)=>{((t,r)=>{let m=h.from(t.dom.parentNode).map(T);m.each(m=>{m.dom.insertBefore(r.dom,t.dom)})})(t,r),((t,r)=>{t.dom.appendChild(r.dom)})(r,t)},en=((t,r)=>{let n=r=>t(r)?h.from(r.dom.nodeValue):h.none();return{get:r=>{if(!t(r))throw Error("Can only get text value of a text node");return n(r).getOr("")},getOption:n,set:(r,m)=>{if(!t(r))throw Error("Can only set raw text value of a text node");r.dom.nodeValue=m}}})(t=>3===t.dom.nodeType),B=t=>en.get(t);var er=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker");let I=(t,r)=>t.isBlock(r)||E(t.schema.getVoidElements(),r.nodeName),R=(t,r)=>"false"===t.getContentEditable(r),M=(t,r)=>!t.isBlock(r)&&E(t.schema.getWhitespaceElements(),r.nodeName),D=(t,r)=>((t,r)=>{let m=y(t.dom.childNodes,T);return m.length>0&&r<m.length?k(m[r],0):k(t,r)})(T(t),r),P=(t,r,m,g,f,p=!0)=>{let C=p?r(!1):m;for(;C;){let m=R(t,C);if(m||M(t,C)){if(m?g.cef(C):g.boundary(C))break;C=r(!0)}else{if(I(t,C)){if(g.boundary(C))break}else 3===C.nodeType&&g.text(C);if(C===f)break;C=r(!1)}}},W=(t,r,m,g,f)=>{var C;if(I(t,m)||R(t,m)||M(t,m)||"true"===t.getContentEditable(m)&&m.parentNode&&"false"===t.getContentEditableParent(m.parentNode))return;let O=null!==(C=t.getParent(g,t.isBlock))&&void 0!==C?C:t.getRoot(),N=new er(m,O),S=f?N.next.bind(N):N.prev.bind(N);P(t,S,m,{boundary:p,cef:p,text:t=>{f?r.fOffset+=t.length:r.sOffset+=t.length,r.elements.push(T(t))}})},$=(t,r,m,g,f,p=!0)=>{let C=new er(m,r),O=[],N={sOffset:0,fOffset:0,elements:[]};W(t,N,m,r,!1);let c=()=>(N.elements.length>0&&(O.push(N),N={sOffset:0,fOffset:0,elements:[]}),!1);return P(t,C.next.bind(C),m,{boundary:c,cef:t=>(c(),f&&O.push(...f.cef(t)),!1),text:t=>{N.elements.push(T(t)),f&&f.text(t,N)}},g,p),g&&W(t,N,g,r,!0),c(),O},V=(t,r)=>{let m=D(r.startContainer,r.startOffset),g=m.element.dom,f=D(r.endContainer,r.endOffset),p=f.element.dom;return $(t,r.commonAncestorContainer,g,p,{text:(t,r)=>{t===p?r.fOffset+=t.length-f.offset:t===g&&(r.sOffset+=m.offset)},cef:r=>((t,r)=>{let m=S.call(t,0);return m.sort((t,r)=>{var m,g,f;return(m=t.elements[0].dom,g=r.elements[0].dom,f=Node.DOCUMENT_POSITION_PRECEDING,0!=(m.compareDocumentPosition(g)&f))?1:-1}),m})(v(((t,r)=>{let m=void 0===r?document:r.dom;return 1!==m.nodeType&&9!==m.nodeType&&11!==m.nodeType||0===m.childElementCount?[]:y(m.querySelectorAll(t),T)})("*[contenteditable=true]",T(r)),r=>{let m=r.dom;return $(t,m,m)}))},!1)},j=(t,r)=>r.collapsed?[]:V(t,r),z=(t,r)=>{let m=t.createRng();return m.selectNode(r),j(t,m)},U=(t,r)=>v(r,r=>{let m=r.elements,g=y(m,B).join(""),f=((t,r,m=0,g=t.length)=>{let f;let p=r.regex;p.lastIndex=m;let C=[];for(;f=p.exec(t);){let t=f[r.matchIndex],m=f.index+f[0].indexOf(t),O=m+t.length;if(O>g)break;C.push({start:m,finish:O}),p.lastIndex=O}return C})(g,t,r.sOffset,g.length-r.fOffset);return((t,r)=>{var m,g;let f=(m=(t,m)=>{let g=B(m),f=t.last,p=f+g.length,C=v(r,(t,r)=>t.start<p&&t.finish>f?[{element:m,start:Math.max(f,t.start)-f,finish:Math.min(p,t.finish)-f,matchId:r}]:[]);return{results:t.results.concat(C),last:p}},g={results:[],last:0},w(t,(t,r)=>{g=m(g,t)}),g).results;return((t,r)=>{if(0===t.length)return[];{let m=r(t[0]),g=[],f=[];for(let p=0,C=t.length;p<C;p++){let C=t[p],O=r(C);O!==m&&(g.push(f),f=[]),m=O,f.push(C)}return 0!==f.length&&g.push(f),g}})(f,t=>t.matchId)})(m,f)}),_=(t,m)=>{b(t,(t,p)=>{b(t,t=>{let C=T(m.cloneNode(!1));((t,m,p)=>{if(!(r(p)||g(p)||f(p)))throw console.error("Invalid call to Attribute.set. Key ",m,":: Value ",p,":: Element ",t),Error("Attribute value was not simple");t.setAttribute(m,p+"")})(C.dom,"data-mce-index",p);let O=t.element.dom;if(O.length===t.finish&&0===t.start)A(t.element,C);else{O.length!==t.finish&&O.splitText(t.finish);let r=O.splitText(t.start);A(T(r),C)}})})},q=t=>t.getAttribute("data-mce-index"),G=(t,r,m,g)=>{let f=t.dom.create("span",{"data-mce-bogus":1});f.className="mce-match-marker";let p=t.getBody();return te(t,r,!1),g?((t,r,m,g)=>{let f=m.getBookmark(),p=t.select("td[data-mce-selected],th[data-mce-selected]"),C=p.length>0?v(p,r=>z(t,r)):j(t,m.getRng()),O=U(r,C);return _(O,g),m.moveToBookmark(f),O.length})(t.dom,m,t.selection,f):((t,r,m,g)=>{let f=z(t,m),p=U(r,f);return _(p,g),p.length})(t.dom,m,p,f)},K=t=>{var r;let m=t.parentNode;t.firstChild&&m.insertBefore(t.firstChild,t),null===(r=t.parentNode)||void 0===r||r.removeChild(t)},H=(t,r)=>{let m=[],g=N.toArray(t.getBody().getElementsByTagName("span"));if(g.length)for(let t=0;t<g.length;t++){let f=q(g[t]);null!==f&&f.length&&f===r.toString()&&m.push(g[t])}return m},J=(t,r,m)=>{let g=r.get(),f=g.index,p=t.dom;m?f+1===g.count?f=0:f++:f-1==-1?f=g.count-1:f--,p.removeClass(H(t,g.index),"mce-match-marker-selected");let C=H(t,f);return C.length?(p.addClass(H(t,f),"mce-match-marker-selected"),t.selection.scrollIntoView(C[0]),f):-1},L=(t,r)=>{let m=r.parentNode;t.remove(r),m&&t.isEmpty(m)&&t.remove(m)},Q=(t,r,m,g,f,p)=>{let N=t.selection,S=((t,r)=>{let m="("+t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&").replace(/\s/g,"[^\\S\\r\\n\\uFEFF]")+")";return r?`(?:^|\\s|${C()})`+m+`(?=$|\\s|${C()})`:m})(m,f),F=N.isForward(),et={regex:new RegExp(S,g?"g":"gi"),matchIndex:1},en=G(t,r,et,p);if(O.browser.isSafari()&&N.setRng(N.getRng(),F),en){let C=J(t,r,!0);r.set({index:C,count:en,text:m,matchCase:g,wholeWord:f,inSelection:p})}return en},X=(t,r)=>{let m=J(t,r,!0);r.set({...r.get(),index:m})},Y=(t,r)=>{let m=J(t,r,!1);r.set({...r.get(),index:m})},Z=t=>{let r=q(t);return null!==r&&r.length>0},ee=(t,r,m,g,f)=>{let p=r.get(),C=p.index,O,S=C;g=!1!==g;let F=t.getBody(),et=N.grep(N.toArray(F.getElementsByTagName("span")),Z);for(let r=0;r<et.length;r++){let N=q(et[r]),F=O=parseInt(N,10);if(f||F===p.index){for(m.length?(et[r].innerText=m,K(et[r])):L(t.dom,et[r]);et[++r];){if((F=parseInt(q(et[r]),10))!==O){r--;break}L(t.dom,et[r])}g&&S--}else O>C&&et[r].setAttribute("data-mce-index",String(O-1))}return r.set({...p,count:f?0:p.count-1,index:S}),g?X(t,r):Y(t,r),!f&&r.get().count>0},te=(t,r,m)=>{let g,f;let p=r.get(),C=N.toArray(t.getBody().getElementsByTagName("span"));for(let t=0;t<C.length;t++){let r=q(C[t]);null!==r&&r.length&&(r===p.index.toString()&&(g||(g=C[t].firstChild),f=C[t].firstChild),K(C[t]))}if(r.set({...p,index:-1,count:0,text:""}),g&&f){let r=t.dom.createRng();return r.setStart(g,0),r.setEnd(f,f.data.length),!1!==m&&t.selection.setRng(r),r}},ne=(t,r)=>{let m=(()=>{let t=(t=>{let r=e(h.none()),o=()=>r.get().each(t);return{clear:()=>{o(),r.set(h.none())},isSet:()=>r.get().isSome(),get:()=>r.get(),set:t=>{o(),r.set(h.some(t))}}})(i);return{...t,on:r=>t.get().each(r)}})();t.undoManager.add();let g=N.trim(t.selection.getContent({format:"text"})),s=t=>{t.setEnabled("next",r.get().count>1),t.setEnabled("prev",r.get().count>1)},a=(t,r)=>{w(["replace","replaceall","prev","next"],m=>t.setEnabled(m,!r))},l=(t,r)=>{r.redial(y(t,r.getData()))},c=(t,r)=>{O.browser.isSafari()&&O.deviceType.isTouch()&&("find"===r||"replace"===r||"replaceall"===r)&&t.focus(r)},d=m=>{te(t,r,!1),a(m,!0),s(m)},u=m=>{let g=m.getData(),f=r.get();if(g.findtext.length){if(f.text===g.findtext&&f.matchCase===g.matchcase&&f.wholeWord===g.wholewords)X(t,r);else{let f=Q(t,r,g.findtext,g.matchcase,g.wholewords,g.inselection);f<=0&&l(!0,m),a(m,0===f)}s(m)}else d(m)},f=r.get(),p={findtext:g,replacetext:"",wholewords:f.wholeWord,matchcase:f.matchCase,inselection:f.inSelection},x=t=>{let r=[{type:"bar",items:[{type:"input",name:"findtext",placeholder:"Find",maximized:!0,inputMode:"search"},{type:"button",name:"prev",text:"Previous",icon:"action-prev",enabled:!1,borderless:!0},{type:"button",name:"next",text:"Next",icon:"action-next",enabled:!1,borderless:!0}]},{type:"input",name:"replacetext",placeholder:"Replace with",inputMode:"search"}];return t&&r.push({type:"alertbanner",level:"error",text:"Could not find the specified string.",icon:"warning"}),r},y=(m,g)=>({title:"Find and Replace",size:"normal",body:{type:"panel",items:x(m)},buttons:[{type:"menu",name:"options",icon:"preferences",tooltip:"Preferences",align:"start",items:[{type:"togglemenuitem",name:"matchcase",text:"Match case"},{type:"togglemenuitem",name:"wholewords",text:"Find whole words only"},{type:"togglemenuitem",name:"inselection",text:"Find in selection"}]},{type:"custom",name:"find",text:"Find",primary:!0},{type:"custom",name:"replace",text:"Replace",enabled:!1},{type:"custom",name:"replaceall",text:"Replace all",enabled:!1}],initialData:g,onChange:(t,g)=>{m&&l(!1,t),"findtext"===g.name&&r.get().count>0&&d(t)},onAction:(m,g)=>{let f=m.getData();switch(g.name){case"find":u(m);break;case"replace":ee(t,r,f.replacetext)?s(m):d(m);break;case"replaceall":ee(t,r,f.replacetext,!0,!0),d(m);break;case"prev":Y(t,r),s(m);break;case"next":X(t,r),s(m);break;case"matchcase":case"wholewords":case"inselection":l(!1,m),(t=>{let m=t.getData(),g=r.get();r.set({...g,matchCase:m.matchcase,wholeWord:m.wholewords,inSelection:m.inselection})})(m),d(m)}c(m,g.name)},onSubmit:t=>{u(t),c(t,"find")},onClose:()=>{t.focus(),te(t,r),t.undoManager.add()}});m.set(t.windowManager.open(y(!1,p),{inline:"toolbar"}))},oe=(t,r)=>()=>{ne(t,r)};t.add("searchreplace",t=>{let r=e({index:-1,count:0,text:"",matchCase:!1,wholeWord:!1,inSelection:!1});return((t,r)=>{t.addCommand("SearchReplace",()=>{ne(t,r)})})(t,r),t.ui.registry.addMenuItem("searchreplace",{text:"Find and replace...",shortcut:"Meta+F",onAction:oe(t,r),icon:"search"}),t.ui.registry.addButton("searchreplace",{tooltip:"Find and replace",onAction:oe(t,r),icon:"search"}),t.shortcuts.add("Meta+F","",oe(t,r)),{done:m=>te(t,r,m),find:(m,g,f,p=!1)=>Q(t,r,m,g,f,p),next:()=>X(t,r),prev:()=>Y(t,r),replace:(m,g,f)=>ee(t,r,m,g,f)}})}();