!function(){"use strict";var t,n=tinymce.util.Tools.resolve("tinymce.PluginManager");let e=t=>n=>t===n,c=e(null),d=e(void 0),s=()=>{},r=()=>!1;let a=class a{constructor(t,n){this.tag=t,this.value=n}static some(t){return new a(!0,t)}static none(){return a.singletonNone}fold(t,n){return this.tag?n(this.value):t()}isSome(){return this.tag}isNone(){return!this.tag}map(t){return this.tag?a.some(t(this.value)):a.none()}bind(t){return this.tag?t(this.value):a.none()}exists(t){return this.tag&&t(this.value)}forall(t){return!this.tag||t(this.value)}filter(t){return!this.tag||t(this.value)?this:a.none()}getOr(t){return this.tag?this.value:t}or(t){return this.tag?this:t}getOrThunk(t){return this.tag?this.value:t()}orThunk(t){return this.tag?this:t()}getOrDie(t){if(this.tag)return this.value;throw Error(null!=t?t:"Called getOrDie on None")}static from(t){return null==t?a.none():a.some(t)}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(t){this.tag&&t(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}};a.singletonNone=new a(!1);let i=(t,n)=>{let c=t.length,d=Array(c);for(let h=0;h<c;h++){let c=t[h];d[h]=n(c,h)}return d},l=t=>{let n=t;return{get:()=>n,set:t=>{n=t}}},h=Object.keys,y=Object.hasOwnProperty,g=(t,n)=>{let c=h(t);for(let d=0,h=c.length;d<h;d++){let h=c[d];n(t[h],h)}},m=(t,n)=>y.call(t,n),b=(t=(t,n)=>n,(...n)=>{if(0===n.length)throw Error("Can't merge zero objects");let c={};for(let d=0;d<n.length;d++){let h=n[d];for(let n in h)m(h,n)&&(c[n]=t(c[n],h[n]))}return c}),p=()=>{let t=(t=>{let n=l(a.none()),o=()=>n.get().each(t);return{clear:()=>{o(),n.set(a.none())},isSet:()=>n.get().isSome(),get:()=>n.get(),set:t=>{o(),n.set(a.some(t))}}})(s);return{...t,on:n=>t.get().each(n)}},v=(t,n,c=0,h)=>{let y=t.indexOf(n,c);return -1!==y&&(!!d(h)||y+n.length<=h)};var C=tinymce.util.Tools.resolve("tinymce.Resource");let f=t=>n=>n.options.get(t),_=f("emoticons_database"),w=f("emoticons_database_url"),j=f("emoticons_database_id"),A=f("emoticons_append"),k=f("emoticons_images_url"),L={symbols:"Symbols",people:"People",animals_and_nature:"Animals and Nature",food_and_drink:"Food and Drink",activity:"Activity",travel_and_places:"Travel and Places",objects:"Objects",flags:"Flags",user:"User Defined"},O=(t,n)=>m(t,n)?t[n]:n,x=t=>{var n;let c=A(t);return n=t=>({keywords:[],category:"user",...t}),((t,n)=>{let c={};return g(t,(t,d)=>{let h=n(t,d);c[h.k]=h.v}),c})(c,(t,c)=>({k:c,v:n(t)}))},E=(t,n)=>v(t.title.toLowerCase(),n)||((t,c)=>{for(let c=0,d=t.length;c<d;c++)if(v(t[c].toLowerCase(),n))return!0;return!1})(t.keywords),S=(t,n,c)=>{let d=[],h=n.toLowerCase(),y=c.fold(()=>r,t=>n=>n>=t);for(let c=0;c<t.length&&(0!==n.length&&!E(t[c],h)||(d.push({value:t[c].char,text:t[c].title,icon:t[c].char}),!y(d.length)));c++);return d},D="pattern",N=(t,n)=>{let d={pattern:"",results:S(n.listAll(),"",a.some(300))},h=l("All"),y=((t,n)=>{let d=null,s=()=>{c(d)||(clearTimeout(d),d=null)};return{cancel:s,throttle:(...n)=>{s(),d=setTimeout(()=>{d=null,t.apply(null,n)},200)}}})(t=>{(t=>{let c=t.getData(),d=h.get(),y=n.listCategory(d),b=S(y,c[D],"All"===d?a.some(300):a.none());t.setData({results:b})})(t)}),b={label:"Search",type:"input",name:D},C={type:"collection",name:"results"},g=()=>({title:"Emojis",size:"normal",body:{type:"tabpanel",tabs:i(n.listCategories(),t=>({title:t,name:t,items:[b,C]}))},initialData:d,onTabChange:(t,n)=>{h.set(n.newTabName),y.throttle(t)},onChange:y.throttle,onAction:(n,c)=>{"results"===c.name&&(((t,n)=>{t.insertContent(n)})(t,c.value),n.close())},buttons:[{type:"cancel",text:"Close",primary:!0}]}),_=t.windowManager.open(g());_.focus(D),n.hasLoaded()||(_.block("Loading emojis..."),n.waitForLoad().then(()=>{_.redial(g()),y.throttle(_),_.focus(D),_.unblock()}).catch(t=>{_.redial({title:"Emojis",body:{type:"panel",items:[{type:"alertbanner",level:"error",icon:"warning",text:"Could not load emojis"}]},buttons:[{type:"cancel",text:"Close",primary:!0}],initialData:{pattern:"",results:[]}}),_.focus(D),_.unblock()}))},T=t=>n=>{let o=()=>{n.setEnabled(t.selection.isEditable())};return t.on("NodeChange",o),o(),()=>{t.off("NodeChange",o)}};n.add("emoticons",(t,n)=>{((t,n)=>{let c=t.options.register;c("emoticons_database",{processor:"string",default:"emojis"}),c("emoticons_database_url",{processor:"string",default:`${n}/js/${_(t)}${t.suffix}.js`}),c("emoticons_database_id",{processor:"string",default:"tinymce.plugins.emoticons"}),c("emoticons_append",{processor:"object",default:{}}),c("emoticons_images_url",{processor:"string",default:"https://twemoji.maxcdn.com/v/13.0.1/72x72/"})})(t,n);let c=((t,n,c)=>{let d=p(),y=p(),_=k(t),i=t=>{var n;return(n=t.char).length>=4&&"<img"===n.substr(0,4)?t.char.replace(/src="([^"]+)"/,(t,n)=>`src="${_}${n}"`):t.char};t.on("init",()=>{C.load(c,n).then(n=>{let c=x(t);(t=>{let n={},c=[];g(t,(t,d)=>{let h={title:d,keywords:t.keywords,char:i(t),category:O(L,t.category)},y=void 0!==n[h.category]?n[h.category]:[];n[h.category]=y.concat([h]),c.push(h)}),d.set(n),y.set(c)})(b(n,c))},t=>{console.log(`Failed to load emojis: ${t}`),d.set({}),y.set([])})});let l=()=>y.get().getOr([]),u=()=>d.isSet()&&y.isSet();return{listCategories:()=>["All"].concat(h(d.get().getOr({}))),hasLoaded:u,waitForLoad:()=>u()?Promise.resolve(!0):new Promise((t,c)=>{let d=15,h=setInterval(()=>{u()?(clearInterval(h),t(!0)):--d<0&&(console.log("Could not load emojis from url: "+n),clearInterval(h),c(!1))},100)}),listAll:l,listCategory:t=>"All"===t?l():d.get().bind(n=>a.from(n[t])).getOr([])}})(t,w(t),j(t));((t,n)=>{t.addCommand("mceEmoticons",()=>N(t,n))})(t,c),(t=>{let e=()=>t.execCommand("mceEmoticons");t.ui.registry.addButton("emoticons",{tooltip:"Emojis",icon:"emoji",onAction:e,onSetup:T(t)}),t.ui.registry.addMenuItem("emoticons",{text:"Emojis...",icon:"emoji",onAction:e,onSetup:T(t)})})(t),((t,n)=>{t.ui.registry.addAutocompleter("emoticons",{trigger:":",columns:"auto",minChars:2,fetch:(t,c)=>n.waitForLoad().then(()=>{let d=n.listAll();return S(d,t,a.some(c))}),onAction:(n,c,d)=>{t.selection.setRng(c),t.insertContent(d),n.hide()}})})(t,c),(t=>{t.on("PreInit",()=>{t.parser.addAttributeFilter("data-emoticon",t=>{((t,n)=>{var c;for(let n=0,d=t.length;n<d;n++)(c=t[n]).attr("data-mce-resize","false"),c.attr("data-mce-placeholder","1")})(t)})})})(t)})}();