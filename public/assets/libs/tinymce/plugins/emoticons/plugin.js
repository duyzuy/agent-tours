!function(){"use strict";var e,t=tinymce.util.Tools.resolve("tinymce.PluginManager");let eq=e=>t=>e===t,o=eq(null),n=eq(void 0),isNullable=e=>null==e,isNonNullable=e=>!isNullable(e),noop=()=>{},never=()=>!1;let Optional=class Optional{constructor(e,t){this.tag=e,this.value=t}static some(e){return new Optional(!0,e)}static none(){return Optional.singletonNone}fold(e,t){return this.tag?t(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(e){return this.tag?Optional.some(e(this.value)):Optional.none()}bind(e){return this.tag?e(this.value):Optional.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(e){return!this.tag||e(this.value)?this:Optional.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw Error(null!=e?e:"Called getOrDie on None")}static from(e){return isNonNullable(e)?Optional.some(e):Optional.none()}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}};Optional.singletonNone=new Optional(!1);let exists=(e,t)=>{for(let o=0,n=e.length;o<n;o++){let n=e[o];if(t(n,o))return!0}return!1},map$1=(e,t)=>{let o=e.length,n=Array(o);for(let a=0;a<o;a++){let o=e[a];n[a]=t(o,a)}return n},each$1=(e,t)=>{for(let o=0,n=e.length;o<n;o++){let n=e[o];t(n,o)}},Cell=e=>{let t=e;return{get:()=>t,set:e=>{t=e}}},last=(e,t)=>{let n=null,cancel=()=>{o(n)||(clearTimeout(n),n=null)};return{cancel,throttle:(...o)=>{cancel(),n=setTimeout(()=>{n=null,e.apply(null,o)},t)}}},insertEmoticon=(e,t)=>{e.insertContent(t)},a=Object.keys,l=Object.hasOwnProperty,each=(e,t)=>{let o=a(e);for(let n=0,a=o.length;n<a;n++){let a=o[n],l=e[a];t(l,a)}},map=(e,t)=>tupleMap(e,(e,o)=>({k:o,v:t(e,o)})),tupleMap=(e,t)=>{let o={};return each(e,(e,n)=>{let a=t(e,n);o[a.k]=a.v}),o},has=(e,t)=>l.call(e,t),i=(e=(e,t)=>t,(...t)=>{if(0===t.length)throw Error("Can't merge zero objects");let o={};for(let n=0;n<t.length;n++){let a=t[n];for(let t in a)has(a,t)&&(o[t]=e(o[t],a[t]))}return o}),singleton=e=>{let t=Cell(Optional.none()),revoke=()=>t.get().each(e);return{clear:()=>{revoke(),t.set(Optional.none())},isSet:()=>t.get().isSome(),get:()=>t.get(),set:e=>{revoke(),t.set(Optional.some(e))}}},value=()=>{let e=singleton(noop);return{...e,on:t=>e.get().each(t)}},checkRange=(e,t,o)=>""===t||e.length>=t.length&&e.substr(o,o+t.length)===t,contains=(e,t,o=0,a)=>{let l=e.indexOf(t,o);return -1!==l&&(!!n(a)||l+t.length<=a)},startsWith=(e,t)=>checkRange(e,t,0);var s=tinymce.util.Tools.resolve("tinymce.Resource");let option=e=>t=>t.options.get(e),register$2=(e,t)=>{let o=e.options.register;o("emoticons_database",{processor:"string",default:"emojis"}),o("emoticons_database_url",{processor:"string",default:`${t}/js/${r(e)}${e.suffix}.js`}),o("emoticons_database_id",{processor:"string",default:"tinymce.plugins.emoticons"}),o("emoticons_append",{processor:"object",default:{}}),o("emoticons_images_url",{processor:"string",default:"https://twemoji.maxcdn.com/v/13.0.1/72x72/"})},r=option("emoticons_database"),c=option("emoticons_database_url"),u=option("emoticons_database_id"),g=option("emoticons_append"),m=option("emoticons_images_url"),h={symbols:"Symbols",people:"People",animals_and_nature:"Animals and Nature",food_and_drink:"Food and Drink",activity:"Activity",travel_and_places:"Travel and Places",objects:"Objects",flags:"Flags",user:"User Defined"},translateCategory=(e,t)=>has(e,t)?e[t]:t,getUserDefinedEmoji=e=>{let t=g(e);return map(t,e=>({keywords:[],category:"user",...e}))},initDatabase=(e,t,o)=>{let n=value(),l=value(),r=m(e),getEmoji=e=>startsWith(e.char,"<img")?e.char.replace(/src="([^"]+)"/,(e,t)=>`src="${r}${t}"`):e.char,processEmojis=e=>{let t={},o=[];each(e,(e,n)=>{let a={title:n,keywords:e.keywords,char:getEmoji(e),category:translateCategory(h,e.category)},l=void 0!==t[a.category]?t[a.category]:[];t[a.category]=l.concat([a]),o.push(a)}),n.set(t),l.set(o)};e.on("init",()=>{s.load(o,t).then(t=>{let o=getUserDefinedEmoji(e);processEmojis(i(t,o))},e=>{console.log(`Failed to load emojis: ${e}`),n.set({}),l.set([])})});let listAll=()=>l.get().getOr([]),hasLoaded=()=>n.isSet()&&l.isSet();return{listCategories:()=>["All"].concat(a(n.get().getOr({}))),hasLoaded,waitForLoad:()=>hasLoaded()?Promise.resolve(!0):new Promise((e,o)=>{let n=15,a=setInterval(()=>{hasLoaded()?(clearInterval(a),e(!0)):--n<0&&(console.log("Could not load emojis from url: "+t),clearInterval(a),o(!1))},100)}),listAll,listCategory:e=>"All"===e?listAll():n.get().bind(t=>Optional.from(t[e])).getOr([])}},emojiMatches=(e,t)=>contains(e.title.toLowerCase(),t)||exists(e.keywords,e=>contains(e.toLowerCase(),t)),emojisFrom=(e,t,o)=>{let n=[],a=t.toLowerCase(),l=o.fold(()=>never,e=>t=>t>=e);for(let o=0;o<e.length&&!((0===t.length||emojiMatches(e[o],a))&&(n.push({value:e[o].char,text:e[o].title,icon:e[o].char}),l(n.length)));o++);return n},d="pattern",open=(e,t)=>{let o={pattern:"",results:emojisFrom(t.listAll(),"",Optional.some(300))},n=Cell("All"),scan=e=>{let o=e.getData(),a=n.get(),l=t.listCategory(a),i=emojisFrom(l,o[d],"All"===a?Optional.some(300):Optional.none());e.setData({results:i})},a=last(e=>{scan(e)},200),l={label:"Search",type:"input",name:d},i={type:"collection",name:"results"},getInitialState=()=>{let s={type:"tabpanel",tabs:map$1(t.listCategories(),e=>({title:e,name:e,items:[l,i]}))};return{title:"Emojis",size:"normal",body:s,initialData:o,onTabChange:(e,t)=>{n.set(t.newTabName),a.throttle(e)},onChange:a.throttle,onAction:(t,o)=>{"results"===o.name&&(insertEmoticon(e,o.value),t.close())},buttons:[{type:"cancel",text:"Close",primary:!0}]}},s=e.windowManager.open(getInitialState());s.focus(d),t.hasLoaded()||(s.block("Loading emojis..."),t.waitForLoad().then(()=>{s.redial(getInitialState()),a.throttle(s),s.focus(d),s.unblock()}).catch(e=>{s.redial({title:"Emojis",body:{type:"panel",items:[{type:"alertbanner",level:"error",icon:"warning",text:"Could not load emojis"}]},buttons:[{type:"cancel",text:"Close",primary:!0}],initialData:{pattern:"",results:[]}}),s.focus(d),s.unblock()}))},register$1=(e,t)=>{e.addCommand("mceEmoticons",()=>open(e,t))},setup=e=>{e.on("PreInit",()=>{e.parser.addAttributeFilter("data-emoticon",e=>{each$1(e,e=>{e.attr("data-mce-resize","false"),e.attr("data-mce-placeholder","1")})})})},init=(e,t)=>{e.ui.registry.addAutocompleter("emoticons",{trigger:":",columns:"auto",minChars:2,fetch:(e,o)=>t.waitForLoad().then(()=>{let n=t.listAll();return emojisFrom(n,e,Optional.some(o))}),onAction:(t,o,n)=>{e.selection.setRng(o),e.insertContent(n),t.hide()}})},onSetupEditable=e=>t=>{let nodeChanged=()=>{t.setEnabled(e.selection.isEditable())};return e.on("NodeChange",nodeChanged),nodeChanged(),()=>{e.off("NodeChange",nodeChanged)}},register=e=>{let onAction=()=>e.execCommand("mceEmoticons");e.ui.registry.addButton("emoticons",{tooltip:"Emojis",icon:"emoji",onAction,onSetup:onSetupEditable(e)}),e.ui.registry.addMenuItem("emoticons",{text:"Emojis...",icon:"emoji",onAction,onSetup:onSetupEditable(e)})};t.add("emoticons",(e,t)=>{register$2(e,t);let o=c(e),n=u(e),a=initDatabase(e,o,n);register$1(e,a),register(e),init(e,a),setup(e)})}();