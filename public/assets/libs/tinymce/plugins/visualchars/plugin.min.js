!function(){"use strict";let t;var r=tinymce.util.Tools.resolve("tinymce.PluginManager");let e=t=>r=>(t=>{var r,l;let a=typeof t;return null===t?"null":"object"===a&&Array.isArray(t)?"array":"object"===a&&((r=String).prototype.isPrototypeOf(t)||(null===(l=t.constructor)||void 0===l?void 0:l.name)===r.name)?"string":a})(r)===t,n=t=>r=>typeof r===t,l=e("string"),a=e("object"),s=t=>null===t,c=n("boolean"),h=n("number");let i=class i{constructor(t,r){this.tag=t,this.value=r}static some(t){return new i(!0,t)}static none(){return i.singletonNone}fold(t,r){return this.tag?r(this.value):t()}isSome(){return this.tag}isNone(){return!this.tag}map(t){return this.tag?i.some(t(this.value)):i.none()}bind(t){return this.tag?t(this.value):i.none()}exists(t){return this.tag&&t(this.value)}forall(t){return!this.tag||t(this.value)}filter(t){return!this.tag||t(this.value)?this:i.none()}getOr(t){return this.tag?this.value:t}or(t){return this.tag?this:t}getOrThunk(t){return this.tag?this.value:t()}orThunk(t){return this.tag?this:t()}getOrDie(t){if(this.tag)return this.value;throw Error(null!=t?t:"Called getOrDie on None")}static from(t){return null==t?i.none():i.some(t)}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(t){this.tag&&t(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}};i.singletonNone=new i(!1);let u=(t,r)=>{for(let l=0,a=t.length;l<a;l++)r(t[l],l)},g=Object.keys,d=(t,r)=>{let l=g(t);for(let a=0,c=l.length;a<c;a++){let c=l[a];r(t[c],c)}},y="undefined"!=typeof window?window:Function("return this;")(),m=(t,r)=>((t,r)=>{let l=null!=r?r:y;for(let r=0;r<t.length&&null!=l;++r)l=l[t[r]];return l})(t.split("."),r),w=Object.getPrototypeOf,v=t=>{let r=m("ownerDocument.defaultView",t);return a(t)&&(((t,r)=>{let l=m(t,r);if(null==l)throw Error(t+" not available on this browser");return l})("HTMLElement",r).prototype.isPrototypeOf(t)||/^HTML\w*Element$/.test(w(t).constructor.name))},f=t=>t.dom.nodeValue,p=t=>r=>r.dom.nodeType===t,b=t=>C(t)&&v(t.dom),C=p(1),O=p(3),A=(t,r,a)=>{((t,r,a)=>{if(!(l(a)||c(a)||h(a)))throw console.error("Invalid call to Attribute.set. Key ",r,":: Value ",a,":: Element ",t),Error("Attribute value was not simple");t.setAttribute(r,a+"")})(t.dom,r,a)},k=(t,r)=>{t.dom.removeAttribute(r)},N=(t,r)=>{let l=((t,r)=>{let l=t.dom.getAttribute(r);return null===l?void 0:l})(t,r);return void 0===l||""===l?[]:l.split(" ")},T=t=>void 0!==t.dom.classList,E=t=>{if(null==t)throw Error("Node cannot be null or undefined");return{dom:t}},V={"\xa0":"nbsp","\xad":"shy"},L=(t,r)=>{let l="";return d(t,(t,r)=>{l+=r}),RegExp("["+l+"]",r?"g":"")},j=L(V),B=L(V,!0),S=(t="",d(V,r=>{t&&(t+=","),t+="span.mce-"+r}),t),q="mce-nbsp",_=t=>t.dom.contentEditable,x=t=>'<span data-mce-bogus="1" class="mce-'+V[t]+'">'+t+"</span>",M=t=>"span"===t.nodeName.toLowerCase()&&t.classList.contains("mce-nbsp-wrap"),P=t=>{let r=f(t);return O(t)&&l(r)&&j.test(r)},D=(t,r,l)=>{let a=[],c=((t,r)=>{let l=t.length,a=Array(l);for(let c=0;c<l;c++){let l=t[c];a[c]=r(l,c)}return a})(t.dom.childNodes,E);return u(c,t=>{l&&(M(t.dom)||!b(t)||"false"!==_(t))&&r(t)&&(a=a.concat([t])),a=a.concat(D(t,r,((t,r)=>{if(b(t)&&!M(t.dom)){let r=_(t);if("true"===r)return!0;if("false"===r)return!1}return r})(t,l)))}),a},H=(t,r)=>{let l=t.dom,a=D(E(r),P,t.dom.isEditable(r));u(a,r=>{var a,c;let h=r.dom.parentNode;if(M(h))T(c=E(h))?c.dom.classList.add(q):((t,r,l)=>{let a=N(t,r).concat([l]);A(t,r,a.join(" "))})(c,"class",q);else{let c;let h=l.encode(null!==(a=f(r))&&void 0!==a?a:"").replace(B,x),g=l.create("div",{},h);for(;c=g.lastChild;)l.insertAfter(c,r.dom);t.dom.remove(r.dom)}})},I=(t,r)=>{let l=t.dom.select(S,r);u(l,r=>{var l;M(r)?(T(l=E(r))?l.dom.classList.remove(q):((t,r,l)=>{let a=((t,r)=>{let a=[];for(let r=0,c=t.length;r<c;r++){let c=t[r];c!==l&&a.push(c)}return a})(N(t,r));a.length>0?A(t,r,a.join(" ")):k(t,r)})(l,"class",q),(t=>{let r=T(t)?t.dom.classList:N(t,"class");0===r.length&&k(t,"class")})(l)):t.dom.remove(r,!0)})},$=t=>{let r=t.getBody(),l=t.selection.getBookmark(),a=((t,r)=>{for(;t.parentNode;){if(t.parentNode===r)return r;t=t.parentNode}})(t.selection.getNode(),r);I(t,a=void 0!==a?a:r),H(t,a),t.selection.moveToBookmark(l)},F=(t,r)=>{((t,r)=>{t.dispatch("VisualChars",{state:r})})(t,r.get());let l=t.getBody();!0===r.get()?H(t,l):I(t,l)},K=t=>t.options.get("visualchars_default_state"),R=(t,r)=>{var l;let a;let c=(l=()=>{$(t)},a=null,{cancel:()=>{s(a)||(clearTimeout(a),a=null)},throttle:(...t)=>{s(a)&&(a=setTimeout(()=>{a=null,l.apply(null,t)},300))}});t.on("keydown",l=>{!0===r.get()&&(13===l.keyCode?$(t):c.throttle())}),t.on("remove",c.cancel)},U=(t,r)=>l=>{l.setActive(r.get());let o=t=>l.setActive(t.state);return t.on("VisualChars",o),()=>t.off("VisualChars",o)};r.add("visualchars",t=>{let r;(t=>{(0,t.options.register)("visualchars_default_state",{processor:"boolean",default:!1})})(t);let l=(r=K(t),{get:()=>r,set:t=>{r=t}});return((t,r)=>{t.addCommand("mceVisualChars",()=>{((t,r)=>{r.set(!r.get());let l=t.selection.getBookmark();F(t,r),t.selection.moveToBookmark(l)})(t,r)})})(t,l),((t,r)=>{let n=()=>t.execCommand("mceVisualChars");t.ui.registry.addToggleButton("visualchars",{tooltip:"Show invisible characters",icon:"visualchars",onAction:n,onSetup:U(t,r)}),t.ui.registry.addToggleMenuItem("visualchars",{text:"Show invisible characters",icon:"visualchars",onAction:n,onSetup:U(t,r)})})(t,l),R(t,l),((t,r)=>{t.on("init",()=>{F(t,r)})})(t,l),{isEnabled:()=>l.get()}})}();