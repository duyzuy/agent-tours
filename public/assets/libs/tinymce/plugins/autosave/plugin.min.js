!function(){"use strict";var t=tinymce.util.Tools.resolve("tinymce.PluginManager");let e=t=>"string"===(t=>{var a,s;let l=typeof t;return null===t?"null":"object"===l&&Array.isArray(t)?"array":"object"===l&&((a=String).prototype.isPrototypeOf(t)||(null===(s=t.constructor)||void 0===s?void 0:s.name)===a.name)?"string":l})(t),r=t=>void 0===t;var a=tinymce.util.Tools.resolve("tinymce.util.Delay"),s=tinymce.util.Tools.resolve("tinymce.util.LocalStorage"),l=tinymce.util.Tools.resolve("tinymce.util.Tools");let n=t=>{let a=/^(\d+)([ms]?)$/.exec(t);return(a&&a[2]?({s:1e3,m:6e4})[a[2]]:1)*parseInt(t,10)},i=t=>a=>a.options.get(t),u=i("autosave_ask_before_unload"),d=i("autosave_restore_when_empty"),c=i("autosave_interval"),D=i("autosave_retention"),m=t=>{let a=document.location;return t.options.get("autosave_prefix").replace(/{path}/g,a.pathname).replace(/{query}/g,a.search).replace(/{hash}/g,a.hash).replace(/{id}/g,t.id)},v=(t,a)=>{if(r(a))return t.dom.isEmpty(t.getBody());{let s=l.trim(a);if(""===s)return!0;{let a=(new DOMParser).parseFromString(s,"text/html");return t.dom.isEmpty(a)}}},f=t=>{var a;let l=parseInt(null!==(a=s.getItem(m(t)+"time"))&&void 0!==a?a:"0",10)||0;return!((new Date).getTime()-l>D(t)&&(p(t,!1),1))},p=(t,a)=>{let l=m(t);s.removeItem(l+"draft"),s.removeItem(l+"time"),!1!==a&&(t=>{t.dispatch("RemoveDraft")})(t)},g=t=>{let a=m(t);!v(t)&&t.isDirty()&&(s.setItem(a+"draft",t.getContent({format:"raw",no_events:!0})),s.setItem(a+"time",(new Date).getTime().toString()),(t=>{t.dispatch("StoreDraft")})(t))},y=t=>{var a;let l=m(t);f(t)&&(t.setContent(null!==(a=s.getItem(l+"draft"))&&void 0!==a?a:"",{format:"raw"}),(t=>{t.dispatch("RestoreDraft")})(t))};var _=tinymce.util.Tools.resolve("tinymce.EditorManager");let h=t=>a=>{a.setEnabled(f(t));let r=()=>a.setEnabled(f(t));return t.on("StoreDraft RestoreDraft RemoveDraft",r),()=>t.off("StoreDraft RestoreDraft RemoveDraft",r)};t.add("autosave",t=>((t=>{let a=t.options.register,o=t=>{let a=e(t);return a?{value:n(t),valid:a}:{valid:!1,message:"Must be a string."}};a("autosave_ask_before_unload",{processor:"boolean",default:!0}),a("autosave_prefix",{processor:"string",default:"tinymce-autosave-{path}{query}{hash}-{id}-"}),a("autosave_restore_when_empty",{processor:"boolean",default:!1}),a("autosave_interval",{processor:o,default:"30s"}),a("autosave_retention",{processor:o,default:"20m"})})(t),(t=>{t.editorManager.on("BeforeUnload",t=>{let a;l.each(_.get(),t=>{t.plugins.autosave&&t.plugins.autosave.storeDraft(),!a&&t.isDirty()&&u(t)&&(a=t.translate("You have unsaved changes are you sure you want to navigate away?"))}),a&&(t.preventDefault(),t.returnValue=a)})})(t),(t=>{(t=>{let s=c(t);a.setEditorInterval(t,()=>{g(t)},s)})(t);let e=()=>{t.undoManager.transact(()=>{y(t),p(t)}),t.focus()};t.ui.registry.addButton("restoredraft",{tooltip:"Restore last draft",icon:"restore-draft",onAction:e,onSetup:h(t)}),t.ui.registry.addMenuItem("restoredraft",{text:"Restore last draft",icon:"restore-draft",onAction:e,onSetup:h(t)})})(t),t.on("init",()=>{d(t)&&t.dom.isEmpty(t.getBody())&&y(t)}),{hasDraft:()=>f(t),storeDraft:()=>g(t),restoreDraft:()=>y(t),removeDraft:a=>p(t,a),isEmpty:a=>v(t,a)}))}();