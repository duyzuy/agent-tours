!function(){"use strict";var e=tinymce.util.Tools.resolve("tinymce.PluginManager"),t=tinymce.util.Tools.resolve("tinymce.dom.RangeUtils"),n=tinymce.util.Tools.resolve("tinymce.util.Tools");let register$2=e=>{let t=e.options.register;t("allow_html_in_named_anchor",{processor:"boolean",default:!1})},allowHtmlInNamedAnchor=e=>e.options.get("allow_html_in_named_anchor"),o="a:not([href])",isEmptyString=e=>!e,getIdFromAnchor=e=>{let t=e.getAttribute("id")||e.getAttribute("name");return t||""},isAnchor=e=>"a"===e.nodeName.toLowerCase(),isNamedAnchor=e=>isAnchor(e)&&!e.getAttribute("href")&&""!==getIdFromAnchor(e),isEmptyNamedAnchor=e=>isNamedAnchor(e)&&!e.firstChild,removeEmptyNamedAnchorsInSelection=e=>{let o=e.dom;t(o).walk(e.selection.getRng(),e=>{n.each(e,e=>{isEmptyNamedAnchor(e)&&o.remove(e,!1)})})},isValidId=e=>/^[A-Za-z][A-Za-z0-9\-:._]*$/.test(e),getNamedAnchor=e=>e.dom.getParent(e.selection.getStart(),o),getId=e=>{let t=getNamedAnchor(e);return t?getIdFromAnchor(t):""},createAnchor=(e,t)=>{e.undoManager.transact(()=>{allowHtmlInNamedAnchor(e)||e.selection.collapse(!0),e.selection.isCollapsed()?e.insertContent(e.dom.createHTML("a",{id:t})):(removeEmptyNamedAnchorsInSelection(e),e.formatter.remove("namedAnchor",void 0,void 0,!0),e.formatter.apply("namedAnchor",{value:t}),e.addVisual())})},updateAnchor=(e,t,n)=>{n.removeAttribute("name"),n.id=t,e.addVisual(),e.undoManager.add()},insert=(e,t)=>{let n=getNamedAnchor(e);n?updateAnchor(e,t,n):createAnchor(e,t),e.focus()},insertAnchor=(e,t)=>isValidId(t)?(insert(e,t),!0):(e.windowManager.alert("ID should start with a letter, followed only by letters, numbers, dashes, dots, colons or underscores."),!1),open=e=>{let t=getId(e);e.windowManager.open({title:"Anchor",size:"normal",body:{type:"panel",items:[{name:"id",type:"input",label:"ID",placeholder:"example"}]},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:{id:t},onSubmit:t=>{insertAnchor(e,t.getData().id)&&t.close()}})},register$1=e=>{e.addCommand("mceAnchor",()=>{open(e)})},isNamedAnchorNode=e=>isEmptyString(e.attr("href"))&&!isEmptyString(e.attr("id")||e.attr("name")),isEmptyNamedAnchorNode=e=>isNamedAnchorNode(e)&&!e.firstChild,setContentEditable=e=>t=>{for(let n=0;n<t.length;n++){let o=t[n];isEmptyNamedAnchorNode(o)&&o.attr("contenteditable",e)}},setup=e=>{e.on("PreInit",()=>{e.parser.addNodeFilter("a",setContentEditable("false")),e.serializer.addNodeFilter("a",setContentEditable(null))})},registerFormats=e=>{e.formatter.register("namedAnchor",{inline:"a",selector:o,remove:"all",split:!0,deep:!0,attributes:{id:"%value"},onmatch:(e,t,n)=>isNamedAnchor(e)})},onSetupEditable=e=>t=>{let nodeChanged=()=>{t.setEnabled(e.selection.isEditable())};return e.on("NodeChange",nodeChanged),nodeChanged(),()=>{e.off("NodeChange",nodeChanged)}},register=e=>{let onAction=()=>e.execCommand("mceAnchor");e.ui.registry.addToggleButton("anchor",{icon:"bookmark",tooltip:"Anchor",onAction,onSetup:t=>{let n=e.selection.selectorChangedWithUnbind("a:not([href])",t.setActive).unbind,o=onSetupEditable(e)(t);return()=>{n(),o()}}}),e.ui.registry.addMenuItem("anchor",{icon:"bookmark",text:"Anchor...",onAction,onSetup:onSetupEditable(e)})};e.add("anchor",e=>{register$2(e),setup(e),register$1(e),register(e),e.on("PreInit",()=>{registerFormats(e)})})}();