!function(){"use strict";var e=tinymce.util.Tools.resolve("tinymce.PluginManager"),a=tinymce.util.Tools.resolve("tinymce.dom.RangeUtils"),h=tinymce.util.Tools.resolve("tinymce.util.Tools");let n=e=>e.options.get("allow_html_in_named_anchor"),g="a:not([href])",r=e=>!e,i=e=>e.getAttribute("id")||e.getAttribute("name")||"",l=e=>"a"===e.nodeName.toLowerCase()&&!e.getAttribute("href")&&""!==i(e),s=e=>e.dom.getParent(e.selection.getStart(),g),d=(e,g)=>{let p=s(e);p?(p.removeAttribute("name"),p.id=g,e.addVisual(),e.undoManager.add()):((e,g)=>{e.undoManager.transact(()=>{n(e)||e.selection.collapse(!0),e.selection.isCollapsed()?e.insertContent(e.dom.createHTML("a",{id:g})):((e=>{let g=e.dom;a(g).walk(e.selection.getRng(),e=>{h.each(e,e=>{l(e)&&!e.firstChild&&g.remove(e,!1)})})})(e),e.formatter.remove("namedAnchor",void 0,void 0,!0),e.formatter.apply("namedAnchor",{value:g}),e.addVisual())})})(e,g),e.focus()},c=e=>r(e.attr("href"))&&!r(e.attr("id")||e.attr("name"))&&!e.firstChild,m=e=>a=>{for(let h=0;h<a.length;h++){let g=a[h];c(g)&&g.attr("contenteditable",e)}},u=e=>a=>{let o=()=>{a.setEnabled(e.selection.isEditable())};return e.on("NodeChange",o),o(),()=>{e.off("NodeChange",o)}};e.add("anchor",e=>{(e=>{(0,e.options.register)("allow_html_in_named_anchor",{processor:"boolean",default:!1})})(e),(e=>{e.on("PreInit",()=>{e.parser.addNodeFilter("a",m("false")),e.serializer.addNodeFilter("a",m(null))})})(e),(e=>{e.addCommand("mceAnchor",()=>{(e=>{let a=(e=>{let a=s(e);return a?i(a):""})(e);e.windowManager.open({title:"Anchor",size:"normal",body:{type:"panel",items:[{name:"id",type:"input",label:"ID",placeholder:"example"}]},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:{id:a},onSubmit:a=>{var h;h=a.getData().id,(/^[A-Za-z][A-Za-z0-9\-:._]*$/.test(h)?(d(e,h),0):(e.windowManager.alert("ID should start with a letter, followed only by letters, numbers, dashes, dots, colons or underscores."),1))||a.close()}})})(e)})})(e),(e=>{let t=()=>e.execCommand("mceAnchor");e.ui.registry.addToggleButton("anchor",{icon:"bookmark",tooltip:"Anchor",onAction:t,onSetup:a=>{let h=e.selection.selectorChangedWithUnbind("a:not([href])",a.setActive).unbind,g=u(e)(a);return()=>{h(),g()}}}),e.ui.registry.addMenuItem("anchor",{icon:"bookmark",text:"Anchor...",onAction:t,onSetup:u(e)})})(e),e.on("PreInit",()=>{(e=>{e.formatter.register("namedAnchor",{inline:"a",selector:g,remove:"all",split:!0,deep:!0,attributes:{id:"%value"},onmatch:(e,a,h)=>l(e)})})(e)})})}();